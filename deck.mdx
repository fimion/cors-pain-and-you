import {
  CodeSurfer,
  CodeSurferColumns,
  Step
} from "code-surfer";
import { nightOwl } from '@code-surfer/themes';
import "prismjs/components/prism-http.js";

export const theme = nightOwl;

# CORS, Pain, and You

## A brief jaunt through the agony of CORS

---

# What is CORS?

## Cross-Origin Resource Sharing (CORS)

```
An HTTP-header based mechanism that allows a server to
indicate any other origins (domain, protocol, or port)
than its own from which a browser should permit loading
of resources.
```

---

<CodeSurfer>

```http title="A Simple HTTP Request"
GET / HTTP/1.1
Host: developer.mozilla.org
Accept-Language: en
```

```diff 1[1:3] title="A Simple HTTP Request" subtitle="Request Method"
```

```diff 1[5] title="A Simple HTTP Request" subtitle="Request Path"
```

```diff 1[7:15] title="A Simple HTTP Request" subtitle="Request Protocol Version"
```

```diff 2:3 title="A Simple HTTP Request" subtitle="Request Headers"
```

</CodeSurfer>

---

<CodeSurfer>

```http title="A Simple HTTP Response"
HTTP/1.1 200 OK
Date: Sat, 09 Oct 2010 14:28:02 GMT
Server: Apache
Last-Modified: Tue, 01 Dec 2009 20:18:22 GMT
ETag: "51142bc1-7449-479b075b2891b"
Accept-Ranges: bytes
Content-Length: 29769
Content-Type: text/html

<!-- here comes the 29769 bytes of the requested web page -->

```

```diff 1[1:9] title="A Simple HTTP Response" subtitle="Response Protocol Version"
```

```diff 1[10:12] title="A Simple HTTP Response" subtitle="Response Status Code"
```

```diff 1[14:16] title="A Simple HTTP Response" subtitle="Response Status Message"
```

```diff 2:8 title="A Simple HTTP Response" subtitle="Response Headers"
```

```diff 10 title="A Simple HTTP Response" subtitle="Response Body"
```

```diff title="A Simple HTTP Response" subtitle="Response Body"
```

</CodeSurfer>

---

# Great, but what about CORS?

---

# Types of CORS Requests

- Simple GET and POST XMLHttpRequests/fetch (no preflight)
- Complex XMLHttpRequests/fetch (required preflight)

---

## What is a Simple CORS Request?

### One of the allowed methods:
 - `GET`
 - `HEAD`
 - `POST`


---

## What is a Simple CORS Request?

### Only has CORS-safelisted request-headers:

 ```
 Accept, Accept-Language,
 Content-Language, Content-Type*,
 DPR, Downlink, Save-Data,
 Viewport-Width, Width
 ```

---

## What is a Simple CORS Request?

### Allowed `Content-Type` values
 - application/x-www-form-urlencoded
 - multipart/form-data
 - text/plain

---

## What is a Simple CORS Request?

 - No event listeners are registered on any XMLHttpRequestUpload object used in the request
 - No ReadableStream object is used in the request.

---

## What is a Simple CORS Request?

As long as the HTTP response contains an `Access-Control-Allow-Origin` header with a value that matches
the request `Origin` header, a simple request will go through.

The browser will stop anything from working that does not fit.
